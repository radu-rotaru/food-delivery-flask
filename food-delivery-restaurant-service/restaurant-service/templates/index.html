<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Menu</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="container">
        <h1>Restaurant Menu Service</h1>

        <!-- List of Restaurants -->
        <div id="restaurants-list">
            <h2>Restaurants</h2>
            <ul id="restaurants">
                <!-- Restaurants will be dynamically loaded here -->
            </ul>
        </div>

        <!-- Add New Restaurant Form -->
        <div id="add-restaurant">
            <h3>Add New Restaurant</h3>
            <form id="restaurant-form">
                <input type="text" id="name" placeholder="Restaurant Name" required>
                <input type="text" id="location" placeholder="Location" required>
                <button type="submit">Add Restaurant</button>
            </form>
        </div>

        <!-- Menu Items of Selected Restaurant -->
        <div id="menu-items">
            <h2>Menu</h2>
            <ul id="menu-list">
                <!-- Menu items will be dynamically loaded here -->
            </ul>
            <h3>Add New Menu Item</h3>
            <form id="menu-form">
                <input type="text" id="menu-name" placeholder="Menu Item Name" required>
                <input type="number" id="menu-price" placeholder="Price" required>
                <button type="submit">Add Menu Item</button>
            </form>
        </div>

    </div>

    <script>
        // Function to load the restaurants
        function loadRestaurants() {
            fetch('/restaurants')
                .then(response => response.json())
                .then(data => {
                    const restaurantList = document.getElementById('restaurants');
                    restaurantList.innerHTML = ''; // Clear existing list
                    data.forEach(restaurant => {
                        const li = document.createElement('li');
                        li.textContent = `${restaurant.name} (${restaurant.location})`;
                        li.onclick = () => loadMenu(restaurant.id);
                        restaurantList.appendChild(li);
                    });
                });
        }

        // Function to load the menu of a specific restaurant
        function loadMenu(restaurantId) {
            fetch(`/restaurants/${restaurantId}/menu`)
                .then(response => response.json())
                .then(data => {
                    const menuList = document.getElementById('menu-list');
                    menuList.innerHTML = ''; // Clear existing menu items
                    data.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = `${item.name} - $${item.price}`;
                        menuList.appendChild(li);
                    });
                    document.getElementById('menu-form').onsubmit = function(event) {
                        event.preventDefault();
                        addMenuItem(restaurantId);
                    };
                });
        }

        // Function to add a new restaurant
        document.getElementById('restaurant-form').onsubmit = function(event) {
            event.preventDefault();
            const name = document.getElementById('name').value;
            const location = document.getElementById('location').value;
            fetch('/restaurants', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ name, location })
            })
            .then(response => response.json())
            .then(data => {
                loadRestaurants(); // Reload restaurant list after adding a new one
                document.getElementById('restaurant-form').reset();
            });
        };

        // Function to add a new menu item
        function addMenuItem(restaurantId) {
            const name = document.getElementById('menu-name').value;
            const price = document.getElementById('menu-price').value;
            fetch(`/restaurants/${restaurantId}/menu`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ name, price })
            })
            .then(response => response.json())
            .then(data => {
                loadMenu(restaurantId); // Reload the menu after adding a new item
                document.getElementById('menu-form').reset();
            });
        }

        // Load restaurants on page load
        window.onload = loadRestaurants;
    </script>

</body>
</html>
